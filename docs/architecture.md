# Putnam SAT Solver - システム設計

## 設計哲学

Putnamは**理解しやすさ**を最優先とした教育・研究目的のSATソルバーです。

- **最小主義**: 複雑な最適化より明確な実装
- **モジュラー設計**: 明確に分離された責務
- **拡張性**: 将来の改良を考慮した構造
- **型安全性**: Rustの型システムによるバグ防止

## アーキテクチャ概要

### 4層構造

```text
┌─────────────────────────────────────┐
│  CLI層 (bin/putnam.rs)               │ ← ユーザーインターフェース
│  ・ファイルI/O、コマンドライン処理      │
└─────────────────────────────────────┘
                    │
┌─────────────────────────────────────┐
│  アルゴリズム層 (solver/)             │ ← 探索ロジック
│  ・DPLL探索、単位伝播                │
└─────────────────────────────────────┘
                    │
┌─────────────────────────────────────┐
│  パース層 (parser.rs)                │ ← 形式変換
│  ・DIMACS ↔ 内部表現                │
└─────────────────────────────────────┘
                    │
┌─────────────────────────────────────┐
│  データ型層 (types.rs)                │ ← 基本データ構造
│  ・変数、リテラル、節、モデル          │
└─────────────────────────────────────┘
```

### データフロー

```text
DIMACS file → parse_and_convert → (Formula, num_vars) → solve → SolveResult
     ↓              ↓                     ↓              ↓         ↓
  file.cnf    内部表現変換            DPLLアルゴリズム    結果    SAT/UNSAT
```

## 重要な設計決定

### 1. **0ベース変数番号**
- DIMACS（1ベース）→ 内部（0ベース）変換
- 配列インデックスとして自然
- バグの原因となりやすい境界を明確化

### 2. **キューベース単位伝播**
- 効率的な制約伝播
- 矛盾の早期発見
- 探索空間の大幅削減

### 3. **不変データ構造**
- バックトラック実装の単純化
- コピーベースの分岐探索
- デバッグの容易さ

### 4. **型駆動設計**
- `Var`、`Lit`、`Val`の明確な区別
- コンパイル時エラーによるバグ防止
- 意図の明確な表現

## 将来の拡張ポイント

### 近い将来
- **Watched Literals**: O(1)伝播の実現
- **改良ヒューリスティック**: VSIDS、JW等

### 中長期
- **CDCL**: 学習による探索効率化
- **並列化**: マルチコア活用
- **言語バインディング**: Python、WebAssembly

---

詳細なAPI仕様は `cargo doc --open` を参照してください。  
初心者向けの解説は [`tutorial.md`](tutorial.md) を参照してください。